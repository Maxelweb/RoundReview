{% extends 'project/base.html' %}

{% block inner_content %}
    <h3><i class="fas fa-file primary my-1"></i> Project Resources</h3>
    <p>Click on a resource to explore more.</p>

    <!--  <script src="https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css" type="text/css" />

    <form action="/file-upload" class="dropzone" id="my-awesome-dropzone">
    </form>  -->

    <div class="my-2">
        <a href="{{ url_for('project.create_object', project_id=project.id) }}"><button><i class="fas fa-plus-circle"></i> New Document</button></a>
    </div>
    
    <table id="resource-table">
        <tr>
            <th>Resource</th>
            <th>Description</th>
            <th>Status</th>
            <th>Version</th>
        </tr>
        {% macro render_tree(tree, parent_path='') %}
            {% for key, value in tree.items() %}
            {% if key != '_objects' %}
                <tr class="folder-row" data-folder-path="{{ parent_path }}/{{ key }}">
                <td>
                    <i class="fas fa-folder"></i>
                    <a href="#" class="folder-link">
                    {{ key }}
                    </a>
                </td>
                <td colspan="3" class="text-muted">Folder</td>
                </tr>
                {% if value %}
                <tr class="folder-content" data-folder-path="{{ parent_path }}/{{ key }}" style="display: none;">
                    <td colspan="4">
                    <table class="nested-table">
                        {{ render_tree(value, parent_path + '/' + key) }}
                    </table>
                    </td>
                </tr>
                {% endif %}
            {% endif %}
            {% endfor %}
            {% for obj in tree['_objects'] %}
            <tr>
                <td>
                    <i class="fas fa-file-alt"></i>
                    <a href="#" class="resource-link">
                    {{ obj.name }}
                    </a>
                </td>
                <td class="small text-muted">{{ obj.description }}</td>
                <td class="small" style="color: 
                    {% if obj.status.value == 'No Review' %}gray
                    {% elif obj.status.value == 'Pending Review' %}orange
                    {% elif obj.status.value == 'Under Review' %}blue
                    {% elif obj.status.value == 'Require Changes' %}red
                    {% elif obj.status.value == 'Approved' %}green
                    {% else %}black
                    {% endif %};">
                    <strong>{{ obj.status.value }}</strong>
                </td>
                <td class="small text-center">{{ obj.version }}</td>
            </tr>
            {% endfor %}
        {% endmacro %}
        {{ render_tree(tree['root']) }}
    </table>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const folderLinks = document.querySelectorAll('.folder-link');
            folderLinks.forEach(link => {
                link.addEventListener('click', function (event) {
                    event.preventDefault();
                    const folderPath = this.closest('.folder-row').dataset.folderPath;
                    const folderContent = document.querySelector(`.folder-content[data-folder-path="${folderPath}"]`);
                    if (folderContent) {
                        folderContent.style.display = folderContent.style.display === 'none' ? '' : 'none';
                    }
                });
            });
        });
    </script>


{% endblock %}