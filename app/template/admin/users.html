{% extends 'base.html' %}

{% block content %}
<section class="content">
    <h2 class="error">{{ title }} <small>admin</small></h2>
    {% if output %}
    <p class="box bg-{{ output[0] }}">{{ output[1] }}</p>
    {% endif %}
    <h3>New user</h3>
    <form action="{{ url_for('admin.users') }}" method="post">
        <fieldset>
            <div class="my-1">
                <input type="hidden" name="target" value="user">
                <input type="text" name="name" placeholder="Username" class="my-1 custom-input" required>
                <input type="email" name="email" placeholder="Email" class="my-1 custom-input" required>
            </div>
            <input type="submit" class="my-1" value="Confirm and Insert">
        </fieldset>
    </form>
    <h3>Edit email</h3>
    <form action="{{ url_for('admin.users') }}" method="post">
        <fieldset>
            <div class="my-1">
                <input type="hidden" name="target" value="email">
                <input type="text" name="user_id" placeholder="User ID" class="my-1 custom-input" required>
                <input type="email" name="email" placeholder="Email" class="my-1 custom-input" required>
            </div>
            <input type="submit" class="my-1" value="Change">
        </fieldset>
    </form>
    <h3>Users list</h3>
    <div class="scroll">
        <table>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Logs</th>
                <th>Admin</th>
                <th>Deleted</th>
                <th style="width: 130px;">&nbsp;</th>
            </tr>
            {% for user in users %}
                <tr {% if selected_user_id == user.id %}class="bg-warning"{% endif %}>
                    <td>#{{ user.id }}</td>
                    <td>{{ user.name }}</td>
                    <td>{{ user.email }}</td>
                    <td><a href="{{ url_for('admin.logs', user_id=user.id) }}">Show</a></td>
                    <td>{% if user.admin %}<i class="fas fa-check"></i>{% else %} - {% endif %}</td>
                    <td>{% if user.deleted %}<i class="fas fa-check"></i>{% else %} - {% endif %}</td>
                    <td>
                        {% if not user.admin %}
                            {% if not user.deleted %}
                            <form action="{{ url_for('admin.users') }}" method="post" class="diblock">
                                <input type="hidden" name="target" value="delete">
                                <input type="hidden" name="user_id" value="{{ user.id }}">
                                <input type="submit" value="Delete">
                            </form>
                            {% else %}
                            <form action="{{ url_for('admin.users') }}" method="post" class="diblock">
                                <input type="hidden" name="target" value="undelete">
                                <input type="hidden" name="user_id" value="{{ user.id }}">
                                <input type="submit" value="Re-enable">
                            </form>
                            {% endif %}
                            <form action="{{ url_for('admin.users') }}" method="post" class="diblock">
                                <input type="hidden" name="target" value="password">
                                <input type="hidden" name="user_id" value="{{ user.id }}">
                                <input type="submit" value="Reset password">
                            </form>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
</section>
{% endblock %}